services:
  app:
    image: hdae/ai-base
    restart: "no"
    ports:
      - "8000:8000"
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - UV_CACHE_DIR=/workspace/.uv-cache
      - PYTHON_VERSION=${PYTHON_VERSION:-3.12}
      - CONFIG=${CONFIG:-sdxl/illustrious}
      - VRAM_PROFILE=${VRAM_PROFILE:-full}
      - OUTPUT_FORMAT=${OUTPUT_FORMAT:-png}
      - CIVITAI_API_KEY=${CIVITAI_API_KEY:-}
      - HF_TOKEN=${HF_TOKEN:-}
      - PROJECT_ROOT=/workspace/app
      - HOST=0.0.0.0
      - PORT=8000
    volumes:
      - app-data:/workspace
      - uv-cache:/workspace/.uv-cache
      - ./start.sh:/start.sh
      - .:/workspace/app
    working_dir: /workspace/app
    tty: true
    security_opt:
      - no-new-privileges:true

volumes:
  app-data:
  uv-cache:
    name: shared_uv-cache
    external: true
